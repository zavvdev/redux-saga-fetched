var hr=Object.defineProperty;var i=(r,e)=>hr(r,"name",{value:e,configurable:!0});var a=class{static{i(this,"Either")}constructor(e){this.$value=e}static right(e){return new F(e)}static left(e){return new S(e)}static map(e){return t=>t?.isRight?new F(e(t.join())):t}static chain(e){return t=>t?.isRight?e(t.join()):t}static mapLeft(e){return t=>t?.isLeft?new S(e(t.join())):t}static chainLeft(e){return t=>t?.isLeft?e(t.join()):t}static isLeft(e){return!!e?.isLeft}static isRight(e){return!!e?.isRight}static join(e){if(e?.isLeft||e?.isRight)return e.join();throw new Error("Not an Either type")}},S=class extends a{static{i(this,"Left")}get isLeft(){return!0}get isRight(){return!1}static of(){throw new Error("`of` called on class Left (value) instead of Either (type)")}map(){return this}join(){return this.$value}},F=class extends a{static{i(this,"Right")}get isLeft(){return!1}get isRight(){return!0}static of(){throw new Error("`of` called on class Right (value) instead of Either (type)")}map(e){return a.right(e(this.$value))}join(){return this.$value}};var E=i(r=>r,"identity"),f=i((r,...e)=>e.reduce((t,o)=>o(t),r),"pipe");var k=i((r,...e)=>t=>e.find(o=>o[0](t))?.[1]?.(t)||r(t),"cond"),_=i(r=>e=>e[r],"prop");function x(r){return typeof r=="string"?a.right(r):a.left("Expected a string")}i(x,"string");function p(r){return typeof r=="number"?a.right(r):a.left("Expected a number")}i(p,"number");function N(r){return Array.isArray(r)?a.right(r):a.left("Expected an array")}i(N,"array");function V(r){return r!=null}i(V,"isNotNullish");var Y=i(r=>e=>{for(let t of e)if(!r.includes(typeof t))return a.left("Expected an array of "+r.join(", "));return a.right(e)},"arrayOf");function Q(r){return r>=0?a.right(r):a.left("Expected a positive number")}i(Q,"positive");function G(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)?a.right(r):a.left("Expected an object")}i(G,"object");function A(r){return typeof r=="function"?a.right(r):a.left("Expected a function")}i(A,"fn");function j(r){return typeof r=="number"||r===void 0?a.right(r):a.left("Expected a number or undefined")}i(j,"numberOrUndefined");var B=i(r=>(e,t,o)=>f(e,o,a.chain(E),a.chainLeft(()=>r[t])),"validate"),W=i((r,e)=>{var t=i(s=>s.some(a.isLeft),"withErrors"),o=i(s=>{throw new Error(s.filter(a.isLeft).map(a.join).join("; "))},"terminate"),n=i(s=>u=>new s(...u.map(a.join)),"init");return f(e,k(n(r),[t,o]))},"instantiate"),z=(()=>{function r(e,t,o,n){this.staleTime=e,this.extractError=t,this.retry=o,this.retryDelay=n}return i(r,"Options"),r.from=function({staleTime:e,extractError:t,retry:o,retryDelay:n}){return W(r,[p(e),A(t),p(o),j(n)])},r.prototype.merge=function(e){var t=B(this);return r.from({staleTime:t(e.staleTime,"staleTime",p),extractError:t(e.extractError,"extractError",A),retry:t(e.retry,"retry",p),retryDelay:t(e.retryDelay,"retryDelay",p)})},r})(),H=(()=>{function r(e,t,o){this.extractError=e,this.retry=t,this.retryDelay=o}return i(r,"Options"),r.from=function({extractError:e,retry:t,retryDelay:o}){return W(r,[A(e),p(t),j(o)])},r.prototype.merge=function(e){var t=B(this);return r.from({extractError:t(e.extractError,"extractError",A),retry:t(e.retry,"retry",p),retryDelay:t(e.retryDelay,"retryDelay",p)})},r})();var J={from:i(function(r){var e=i(t=>{throw new Error(t)},"terminate");return f(r(),x,a.chain(E),a.chainLeft(e))},"from")};var X={from:i(function(r){var e=i(t=>{throw new Error(t)},"terminate");return f(r(),p,a.chain(Q),a.chain(E),a.chainLeft(e))},"from")};import{delay as Er,call as O}from"redux-saga/effects";var K={extractError:i(r=>r?.message||r?.name||"An error occurred","extractError")},Z={retry:3},rr={retry:0},w={query:"query",mutation:"mutation"},v={request:"request",success:"success",failure:"failure",invalidate:"invalidate",reset:"reset"};var er=i(r=>e=>{var t=r(),o=i(u=>c=>`${u}_${c}@${e}#${t}`,"pattern"),n=o("query"),s=o("mutation");return{[w.query]:{[v.request]:n("request"),[v.success]:n("success"),[v.failure]:n("failure"),[v.invalidate]:n("invalidate"),[v.reset]:n("reset")},[w.mutation]:{[v.request]:s("request"),[v.success]:s("success"),[v.failure]:s("failure")}}},"createActionTypePatterns"),h=i(r=>e=>`${r}@${e}`,"createActionType"),g=i(r=>({type:e,data:t,timestamp:o,error:n})=>({type:e,payload:{key:r,data:t,timestamp:o,error:n}}),"createAction"),R=i((r,e)=>(t={})=>t?.[r]?.[e]?.data||null,"selectData"),q=i((r,e)=>(t={})=>{var o=t?.[r]?.[e]||{};return!!(o.isLoading||o.isFetching)},"selectIsInProgress"),b=i((r,e)=>(t={})=>t?.[r]?.[e]||{},"selectKeyState"),I=i((r,e)=>(t={})=>f(t?.[e]||{},G,a.chain(o=>Object.keys(o).filter(n=>n.startsWith(r))),a.chainLeft(()=>[])),"selectMatchedKeys");function*P(r,e,t){function*o(n=0){try{return yield O(r)}catch(s){if(n===e)throw s;return yield Er(t??1e3*(1<<n)),yield O(o,n+1)}}return i(o,"runner"),yield O(o)}i(P,"withRetry");var d={from:i(r=>{var e=["string","number","bigint","boolean"],t=i(u=>{throw new Error(u)},"terminate"),o=i(u=>u.filter(V),"removeNullish"),n=Y(e),s=i(u=>u.join("_"),"compose");return f(N(r),a.map(o),a.chain(n),a.chain(s),a.chainLeft(t))},"from")};var tr=i(function(r){return e=>t=>{var o=d.from(e);return t?.[r]?.[o]||null}},"getSelector");var gr=i(r=>a.isRight(x(r.type))&&a.isRight(x(r.payload?.key))?a.right(r):a.left(r),"validateAction"),Tr=i(r=>e=>e.type.includes(r),"actionTypeMatch"),L=i(r=>r||null,"dataFallback"),xr=i(r=>e=>({...r,...e}),"mergeStates"),Lr=i(r=>e=>({[r]:e}),"assignKey"),D={request:i(r=>e=>{var{payload:t}=e,o=!r?.[t.key]?.data;return{isLoading:o,isFetching:!0,isLoaded:!1,isError:!1,isValid:!1,isReset:!1,timestamp:void 0,data:L(r?.[t.key]?.data),error:null}},"request"),success:i(()=>({payload:r})=>({isLoading:!1,isFetching:!1,isLoaded:!0,isError:!1,isValid:!0,isReset:!1,timestamp:r.timestamp,data:L(r?.data),error:null}),"success"),failure:i(r=>({payload:e})=>({isLoading:!1,isFetching:!1,isLoaded:!1,isError:!0,isValid:!1,isReset:!1,timestamp:void 0,data:L(r?.[e?.key]?.data),error:e.error||null}),"failure"),invalidate:i(r=>({payload:e})=>({isLoading:!!r?.[e.key]?.isLoading,isFetching:!!r?.[e.key]?.isFetching,isLoaded:!!r?.[e.key]?.isLoaded,isError:!!r?.[e.key]?.isError,isValid:!1,isReset:!1,timestamp:void 0,data:L(r?.[e.key]?.data),error:r?.[e.key]?.error||null}),"invalidate"),reset:i(()=>()=>({isLoading:!1,isFetching:!1,isLoaded:!1,isError:!1,isValid:!1,isReset:!0,timestamp:void 0,data:null,error:null}),"reset")},U={request:i(r=>({payload:e})=>({isLoading:!0,isLoaded:!1,isError:!1,data:L(r?.[e.key]?.data),error:null}),"request"),success:i(()=>({payload:r})=>({isLoading:!1,isLoaded:!0,isError:!1,data:L(r?.data),error:null}),"success"),failure:i(r=>({payload:e})=>({isLoading:!1,isLoaded:!1,isError:!0,data:L(r?.[e?.key]?.data),error:e.error||null}),"failure")},Ar=i((r,e)=>t=>f(e(r)(t),Lr(t.payload.key),xr(r)),"toNextState"),ir=i(function(r){var{query:e,mutation:t}=r,o=[[e.request,D.request],[e.success,D.success],[e.failure,D.failure],[e.invalidate,D.invalidate],[e.reset,D.reset],[t.request,U.request],[t.success,U.success],[t.failure,U.failure]];return function(n,s={}){var u=i(()=>n||{},"stateIdentity"),c=k(u,...o.map(([l,m])=>[Tr(l),Ar(n,m)]));return f(s,gr,a.chain(c),a.chainLeft(u))}},"getReducer");import{call as ar,put as M,select as $}from"redux-saga/effects";var wr=i((r,e,t,o)=>(n={})=>{var s=n?.[r]?.[e]||{},u=s?.timestamp;return!u||a.isLeft(p(u))?!1:t()-u<o},"selectIsValid");function*Dr({fn:r,action:e,actionType:t,patterns:o,createTimestamp:n,extractError:s,retry:u,retryDelay:c}){try{yield M(e({type:t(o.query.request)}));var l=yield ar(P,r,u,c),m=n();return yield M(e({type:t(o.query.success),data:l,timestamp:m})),l}catch(T){var y=s(T);throw yield M(e({type:t(o.query.failure),error:y})),y}}i(Dr,"executor");var or=i(({domain:r,actionTypePatterns:e,initOptions:t,createTimestamp:o})=>function*({key:n,fn:s,options:u}){var c=t.merge({staleTime:u?.staleTime,extractError:u?.extractError,retry:u?.retry,retryDelay:u?.retryDelay}),l=d.from(n),m=h(l),y=g(l),T=i(()=>R(r,l),"stateSelector"),dr=yield $(q(r,l)),vr=yield $(wr(r,l,o,c.staleTime));return dr||vr?yield $(T()):yield ar(Dr,{fn:s,action:y,actionType:m,patterns:e,createTimestamp:o,extractError:c.extractError,retry:c.retry,retryDelay:c.retryDelay})},"getQuery");import{call as sr,put as C,select as nr}from"redux-saga/effects";function*Sr({fn:r,action:e,actionType:t,patterns:o,extractError:n,retry:s,retryDelay:u}){try{yield C(e({type:t(o.mutation.request)}));var c=yield sr(P,r,s,u);return yield C(e({type:t(o.mutation.success),data:c})),c}catch(m){var l=n(m);throw yield C(e({type:t(o.mutation.failure),error:l})),l}}i(Sr,"executor");var ur=i(({domain:r,actionTypePatterns:e,initOptions:t})=>function*({key:o,fn:n,options:s}){var u=t.merge({extractError:s?.extractError,retry:s?.retry,retryDelay:s?.retryDelay}),c=d.from(o),l=h(c),m=g(c),y=i(()=>R(r,c),"stateSelector"),T=yield nr(q(r,c));return T?yield nr(y()):yield sr(Sr,{fn:n,action:m,actionType:l,patterns:e,extractError:u.extractError,retry:u.retry,retryDelay:u.retryDelay})},"getMutation");import{put as Fr,select as cr}from"redux-saga/effects";var lr=i(({actionTypePatterns:r,domain:e})=>function*({key:t}){var o=d.from(t),n=yield cr(I(o,e));for(let s of n){let u=yield cr(b(e,s)),c=h(s),l=g(s);u.isValid&&!u.isLoading&&!u.isFetching&&(yield Fr(l({type:c(r.query.invalidate)})))}},"getInvalidate");import{put as kr,select as fr}from"redux-saga/effects";var yr=i(({actionTypePatterns:r,domain:e})=>function*({key:t}){var o=d.from(t),n=yield fr(I(o,e));for(let s of n){let u=yield fr(b(e,s)),c=h(s),l=g(s);u.isReset||(yield kr(l({type:c(r.query.reset)})))}},"getReset");var mr={from:i(function(r){var e=i(t=>{throw new Error(t)},"terminate");return f(r,x,a.chain(E),a.chainLeft(e))},"from")};function pr({actionTypePatterns:r}){return({type:e,stage:t,key:o})=>{var n=i(c=>{throw new Error(c)},"terminate"),s=i(([c,l])=>{var m=Object.values(w),y=Object.values(v);return m.includes(c)&&y.includes(l)?a.right([c,l]):a.left("Invalid effect type or stage")},"validate"),u=i(([c,l])=>{var m=d.from(o),y=h(m);return f(r,_(c),_(l),y)},"compose");return f([e,t],s,a.chain(u),a.chainLeft(n))}}i(pr,"getCreateActionType");var Rr=1;function st({domain:r,extractError:e,retry:t,retryDelay:o,query:n,mutation:s,createInstanceId:u}){var c=mr.from(r),l=z.from({staleTime:n.staleTime,extractError:e||n.extractError||K.extractError,retry:t??n.retry??Z.retry,retryDelay:o??n.retryDelay}),m=H.from({extractError:e||s?.extractError||K.extractError,retry:s?.retry||rr.retry,retryDelay:s?.retryDelay}),y=er(()=>J.from(u||(()=>String(Rr++))))(c),T=i(()=>X.from(Date.now),"createTimestamp");return{reducer:ir(y),selector:tr(c),query:or({domain:c,actionTypePatterns:y,initOptions:l,createTimestamp:T}),mutation:ur({domain:c,actionTypePatterns:y,initOptions:m}),invalidate:lr({domain:c,actionTypePatterns:y}),reset:yr({domain:c,actionTypePatterns:y}),createActionType:pr({actionTypePatterns:y})}}i(st,"initSagaQuery");export{st as initSagaQuery};
